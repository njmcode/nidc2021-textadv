!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("compromise")):"function"==typeof define&&define.amd?define(["compromise"],n):(t||self).nidc2021Textadv=n(t.compromise)}(this,function(t){function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e,o=/*#__PURE__*/n(t);function i(){return i=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},i.apply(this,arguments)}var r={n:"n",e:"e",w:"w",s:"s",up:"up",down:"down",in:"in",out:"out",look:"look",examine:"examine",get:"get",drop:"drop",inventory:"inventory",help:"help"},a=((e={})[r.n]=["north","go north"],e[r.e]=["east","go east"],e[r.w]=["west","go west"],e[r.s]=["south","go south"],e[r.up]=["u","go up","ascend"],e[r.down]=["d","go down","descend"],e[r.in]=["enter","go in","get in"],e[r.out]=["leave","go out","get out","exit"],e[r.look]=["look around","where","where am i","whereami"],e[r.examine]=["look at","inspect","x","ex","search","check"],e[r.get]=["g","take","pick up","obtain","acquire","grab"],e[r.drop]=["put down","toss","remove","discard"],e[r.inventory]=["inv","carrying","equipment","items","gear"],e[r.help]=["instructions","howto","how to play","?","commands","verbs","words","controls"],e),u={LOCATION_ITEMS_PREFIX:"You can see ",INV_PREFIX:"You are carrying ",INV_NONE:"You are carrying nothing.",FAIL_UNKNOWN:"Sorry, I don't understand.",FAIL_UNHANDLED:"Sorry, I can't do that.",FAIL_NO_EXIT:"You can't go that way.",FAIL_EXAMINE:"Sorry, I can't see that.",FAIL_GET:"Sorry, I can't get that.",FAIL_GET_OWNED:"You already seem to have that.",FAIL_DROP:"Sorry, I can't drop that.",FAIL_DROP_OWNED:"You don't seem to have that.",OK_GET:"Taken.",OK_DROP:"Dropped."},c={inputForm:".game-input",inputField:".game-typed-input",output:".game-output"},s="hidden",d=function(t){var n=t.UI,e=t.gameState,o=[],i=!1,r=function t(){if(!i){if(0===o.length)return i=!1,void(e.isActive&&n.showInput());i=!0;var r=o.shift();"pauseTime"in r?setTimeout(function(){i=!1,t()},r.pauseTime):(n.writeOutput(r.outputText,r.cssClass),n.scrollToBottom(),i=!1,t())}};return{add:function(t){o.push(t),r()}}},f=Object.freeze({SILENT:"silent",INVISIBLE:"invisible",FIXED:"fixed",QUIET:"quiet",SCENERY:"scenery"});return{start:function(t){var n,e,p=function(t){var n=i({},r),e=i({},a);t.commands&&Object.entries(t.commands).forEach(function(t){var o=t[0],i=t[1];n[o]=o,e[o]=i});var u=Object.entries(e).reduce(function(t,n){var e=n[0],o=n[1];return t[e]=e,o.forEach(function(n){t[n]=e}),t},{});return o.default.extend(function(t,n){var e=Object.keys(u).reduce(function(t,n){return t[n]="Verb",t},{});n.addWords(e)}),{commands:n,aliases:e,baseCommandMap:u,nlp:o.default}}(t),l=p.commands,m=p.aliases,v=p.baseCommandMap,g=function(t){var n,e={},i=t.entities.reduce(function(o,r,a){var u=r(function(){return i[u.id]});if(!u.id)throw console.error(u),new Error("Missing entity id");return u.is=function(t){return u.id===t},u.exists=!0,u.meta={visitCount:0,isInitialState:!0,isExamined:!1},u.nouns&&u.nouns.forEach(function(t){if(t in e)throw new Error("Duplicate noun '"+t+"' found for entity '"+u.id+"'");e[t]=u.id}),u.data||(u.data={}),u.things||(u.things=[]),u.tags||(u.tags=[]),u.things=new Set(u.things),u.tags=new Set(u.tags),o[u.id]=u,0===a&&(n=t.startLocationId||u.id),o},{});return o.default.extend(function(t,n){var o=Object.keys(e).reduce(function(t,n){return t[n]="Noun",t},{});n.addWords(o)}),{entities:i,baseNounMap:e,startLocationId:n,getSubject:function(t,n,o){if(void 0===o&&(o=function(){return!0}),!(t in e))return!1;n instanceof Array||(n=[n]);var r=i[e[t]],a=!1;return n.forEach(function(t){t.has(r.id)&&o(r)&&(a=r)}),a}}}(t),I=g.entities,h=g.startLocationId,T=g.getSubject,y=i({},u),E={turnCount:0,isActive:!0,currentLocationId:h,inventory:new Set(t.startInventory||[]),lastSubject:null},S=function(t){void 0===t&&(t={});var n=i({},c,t),e=Object.entries(n).reduce(function(t,n){var e=n[0],o=n[1],i=document.querySelector(o);if(!i)throw new Error("No DOM element found for selector: "+o);return t[e]=i,t},{}),o=function(){return e.inputField.value.trim()};return{els:e,onSubmit:function(t){e.inputForm.addEventListener("submit",function(n){n.preventDefault(),t(o())})},getInput:o,clearInput:function(){e.inputField.value=""},hideInput:function(){e.inputForm.classList.add(s)},showInput:function(){e.inputForm.classList.remove(s)},clearOutput:function(){e.output.innerHTML=""},writeOutput:function(t,n){var o=document.createElement("p");o.innerHTML=t,n&&o.classList.add(n),e.output.appendChild(o)},scrollToBottom:function(){window.scrollTo(0,document.body.scrollHeight)}}}(),L=d({UI:S,gameState:E}),N={ALIASES:m,COMMANDS:l,clear:function(){S.clearOutput()},doTurn:function(){E.turnCount+=1},dyntext:function(t){return"function"==typeof t?t(N):t},end:function(){E.isActive=!1,S.hideInput()},entity:function(t){if(!I[t])throw new Error("Game logic error: no entity '"+t+"' found");return I[t]},goTo:function(n,e){void 0===e&&(e=!1);var o=N.entity(n),i=!1,r=null,a=function(){i=!0},u=function(t){r=t};"function"==typeof t.onGoTo&&t.onGoTo({game:N,destination:o,stopGoTo:a,afterGoTo:u}),E.isActive&&!i&&("function"==typeof o.onGoTo&&o.onGoTo({game:N,stopGoTo:a,afterGoTo:u}),E.isActive&&!i&&(E.currentLocationId=n,N.location.meta.visitCount+=1,N.look(),e||N.doTurn(),"function"==typeof r&&r()))},get inventory(){return E.inventory},get location(){return I[E.currentLocationId]},look:function(t){void 0===t&&(t=!1);var n=t||1===N.location.meta.visitCount;if(N.print(n?N.location.description:N.location.summary),N.location.things.size>0){var e=[].concat(N.location.things).map(function(t){return I[t]}).filter(function(t){return!t.tags.has(f.INVISIBLE)&&!t.tags.has(f.SCENERY)&&!t.tags.has(f.SILENT)});if(n){var o=e.filter(function(t){return t.meta.isInitialState&&t.initial});o.length>0&&o.forEach(function(t){N.print(t.initial)}),e=e.filter(function(t){return!o.includes(t)})}if(e.length>0){var i=""+y.LOCATION_ITEMS_PREFIX+e.map(function(t){return N.dyntext(t.summary)}).join(", ")+".";N.print(i)}}},MESSAGES:y,noTurn:function(){e=!1},pause:function(t){void 0===t&&(t=0),S.hideInput(),L.add({pauseTime:t})},print:function(t,n){t&&(t instanceof Array?t.forEach(function(t){return N.print(t,n)}):L.add({outputText:N.dyntext(t),cssClass:n}))},get state(){return E},TAGS:f};S.onSubmit(function(i){i&&E.isActive&&(n=null,e=!0,N.print(i,"input"),S.clearInput(),function(t){var n=t.API,e=t.baseCommandMap,i=t.entities,r=t.commands,a=t.gameState,u=t.getSubject,c=t.config,s=t.gameMessages,d=t.afterCommand,p=o.default(t.inputText.toLowerCase()),l=p.verbs().out("array")[0],m=p.nouns().out("array")[0];if(!(l in e))return n.print(s.FAIL_UNKNOWN),void n.noTurn();var v=e[l],g=u(m,[n.location.things,n.inventory],function(t){return!t.tags.has(f.INVISIBLE)});if("function"==typeof c.onCommand){var I=!1,h=Object.keys(r).reduce(function(t,n){return t[n]=v===n,t},{});if(h._base=v,c.onCommand({command:h,subject:g||{is:function(){return!1},exists:!1},game:n,stopCommand:function(t){void 0===t&&(t=!1),I=!0,t&&n.noTurn()},afterCommand:d,noTurn:n.noTurn}),I)return}if(a.isActive)if(n.location.to&&v in n.location.to)n.goTo(n.location.to[v]);else switch(v){case r.n:case r.s:case r.e:case r.w:case r.up:case r.down:case r.in:case r.out:return void n.print(s.FAIL_NO_EXIT);case r.look:return n.look(!0),void n.noTurn();case r.examine:return g?(n.print(g.description),void(g.meta.isExamined=!0)):(n.print(s.FAIL_EXAMINE),void n.noTurn());case r.get:return!g||g.tags.has(f.SCENERY)||g.tags.has(f.FIXED)?(n.print(s.FAIL_GET),void n.noTurn()):n.inventory.has(g.id)?(n.print(s.FAIL_GET_OWNED),void n.noTurn()):(n.location.things.delete(g.id),n.inventory.add(g.id),g.meta.isInitialState=!1,void n.print(s.OK_GET));case r.drop:return g&&n.inventory.has(g.id)?g.tags.has(f.FIXED)?(n.print(s.FAIL_DROP),void n.noTurn()):(n.inventory.delete(g.id),n.location.things.add(g.id),g.meta.isInitialState=!1,void n.print(s.OK_DROP)):(n.print(s.FAIL_DROP_OWNED),void n.noTurn());case r.inventory:if(0===n.inventory.size)return n.print(s.INV_NONE),void n.noTurn();var T=[].concat(n.inventory).map(function(t){return i[t]}).filter(function(t){return!t.tags.has(f.INVISIBLE)&&!t.tags.has(f.SILENT)}).map(function(t){return n.dyntext(t.summary)}).join(", ");return n.print(""+s.INV_PREFIX+T+"."),void n.noTurn();case r.help:return n.print("Basic commands: "+Object.values(r).join(", ")+". Try other words too!","info"),void n.noTurn();default:n.print(s.FAIL_UNHANDLED),n.noTurn()}}({inputText:i,API:N,baseCommandMap:v,entities:I,commands:l,gameState:E,getSubject:T,config:t,gameMessages:y,afterCommand:function(t){n=t}}),E.isActive&&("function"==typeof n&&(n(),n=null),E.isActive&&e&&(N.doTurn(),"function"==typeof t.onTurn&&t.onTurn({game:N,turnCount:E.turnCount}))))}),S.clearOutput(),N.goTo(E.currentLocationId,!0)}}});
//# sourceMappingURL=index.umd.js.map

function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=/*#__PURE__*/t(require("compromise"));function e(){return e=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},e.apply(this,arguments)}var o,i=function(t,n){return t.reduce(function(t,e){return t[e]=n(t,e),t},{})},r={n:"n",e:"e",w:"w",s:"s",up:"up",down:"down",in:"in",out:"out",look:"look",examine:"examine",get:"get",drop:"drop",inventory:"inventory",help:"help"},u=((o={})[r.n]=["north","go north"],o[r.e]=["east","go east"],o[r.w]=["west","go west"],o[r.s]=["south","go south"],o[r.up]=["u","go up","ascend"],o[r.down]=["d","go down","descend"],o[r.in]=["enter","go in","get in"],o[r.out]=["leave","go out","get out","exit"],o[r.look]=["look around","where","where am i","whereami"],o[r.examine]=["look at","inspect","x","ex","search","check"],o[r.get]=["g","take","pick up","obtain","acquire","grab"],o[r.drop]=["put down","toss","remove","discard"],o[r.inventory]=["inv","carrying","equipment","items","gear"],o[r.help]=["instructions","howto","how to play","?","commands","verbs","words","controls"],o),a={LOCATION_ITEMS_PREFIX:"You can see ",INV_PREFIX:"You are carrying ",INV_NONE:"You are carrying nothing.",FAIL_UNKNOWN:"Sorry, I don't understand.",FAIL_UNHANDLED:"Sorry, I can't do that.",FAIL_NO_EXIT:"You can't go that way.",FAIL_EXAMINE:"Sorry, I can't see that.",FAIL_GET:"Sorry, I can't get that.",FAIL_GET_OWNED:"You already seem to have that.",FAIL_DROP:"Sorry, I can't drop that.",FAIL_DROP_OWNED:"You don't seem to have that.",OK_GET:"Taken.",OK_DROP:"Dropped."},s={inputForm:".game-input",inputField:".game-typed-input",output:".game-output"},c=function(t){var n=t.UI,e=t.gameState,o=[],i=!1,r=function t(){if(!i){if(0===o.length)return i=!1,void(e.isActive&&n.showInput());i=!0;var r=o.shift();"pauseTime"in r?setTimeout(function(){i=!1,t()},r.pauseTime):(n.writeOutput(r.outputText,r.cssClass),n.scrollToBottom(),i=!1,t())}};return{add:function(t){o.push(t),r()}}},d=Object.freeze({SILENT:"silent",INVISIBLE:"invisible",FIXED:"fixed",QUIET:"quiet",SCENERY:"scenery"}),f=function(t,n){return t.map(function(t){return n.dyntext(t.summary)}).join(", ")};module.exports={start:function(t){var o,p,l=function(t){var o=e({},r),a=e({},u);t.commands&&Object.entries(t.commands).forEach(function(t){var n=t[0],e=t[1];o[n]=n,a[n]=e});var s=i(Object.keys(a),function(t,n){return a[n].forEach(function(e){t[e]=n}),n});return n.default.extend(function(t,n){var e=i(Object.keys(s),function(){return"Verb"});n.addWords(e)}),{commands:o,aliases:a,baseCommandMap:s,nlp:n.default}}(t),m=l.commands,v=l.aliases,g=l.baseCommandMap,I=function(t){var e,o={},r=t.entities.reduce(function(n,i,u){var a=i(function(){return r[a.id]});if(!a.id)throw console.error(a),new Error("Missing entity id");return a.is=function(t){return a.id===t},a.exists=!0,a.meta={visitCount:0,isInitialState:!0,isExamined:!1},a.data||(a.data={}),a.things||(a.things=[]),a.tags||(a.tags=[]),a.things=new Set(a.things),a.tags=new Set(a.tags),a.nouns&&a.nouns.forEach(function(t){if(t in o)throw new Error("Duplicate noun '"+t+"' found for entity '"+a.id+"'");o[t]=a.id}),n[a.id]=a,0===u&&(e=t.startLocationId||a.id),n},{});return n.default.extend(function(t,n){var e=i(Object.keys(o),function(){return"Noun"});n.addWords(e)}),{entities:r,baseNounMap:o,startLocationId:e,getSubject:function(t,n,e){if(void 0===e&&(e=function(){return!0}),!(t in o))return!1;n instanceof Array||(n=[n]);var i=r[o[t]],u=!1;return n.forEach(function(t){t.has(i.id)&&e(i)&&(u=i)}),u}}}(t),h=I.entities,T=I.startLocationId,y=I.getSubject,E=e({},a),S={turnCount:0,isActive:!0,currentLocationId:T,inventory:new Set(t.startInventory||[]),lastSubject:null},L=function(t){void 0===t&&(t={});var n=e({},s,t),o=i(Object.keys(n),function(t,e){var o=n[e],i=document.querySelector(o);if(!i)throw new Error("No DOM element found for selector: "+o);return i}),r=function(){return o.inputField.value.trim()};return{els:o,onSubmit:function(t){o.inputForm.addEventListener("submit",function(n){n.preventDefault(),t(r())})},getInput:r,clearInput:function(){o.inputField.value=""},hideInput:function(){o.inputForm.classList.add("hidden")},showInput:function(){o.inputForm.classList.remove("hidden")},clearOutput:function(){o.output.innerHTML=""},writeOutput:function(t,n){var e=document.createElement("p");e.innerHTML=t,n&&e.classList.add(n),o.output.appendChild(e)},scrollToBottom:function(){window.scrollTo(0,document.body.scrollHeight)}}}(),N=c({UI:L,gameState:S}),O={ALIASES:v,COMMANDS:m,clear:function(){L.clearOutput()},doTurn:function(){S.turnCount+=1},dyntext:function(t){return"function"==typeof t?t(O):t},end:function(){S.isActive=!1,L.hideInput()},entity:function(t){if(!h[t])throw new Error("Game logic error: no entity '"+t+"' found");return h[t]},goTo:function(n,e){void 0===e&&(e=!1);var o=O.entity(n),i=!1,r=null,u=function(){i=!0},a=function(t){r=t};"function"==typeof t.onGoTo&&t.onGoTo({game:O,destination:o,stopGoTo:u,afterGoTo:a}),S.isActive&&!i&&("function"==typeof o.onGoTo&&o.onGoTo({game:O,stopGoTo:u,afterGoTo:a}),S.isActive&&!i&&(S.currentLocationId=n,O.location.meta.visitCount+=1,O.look(),e||O.doTurn(),"function"==typeof r&&r()))},get inventory(){return S.inventory},get location(){return h[S.currentLocationId]},look:function(t){void 0===t&&(t=!1);var n=O.location,e=t||1===n.meta.visitCount;if(O.print(e?n.description:n.summary),0!==n.things.size){var o,i=function(t,n){return[].concat(t.things).map(function(t){return n[t]}).filter(function(t){return!t.tags.has(d.INVISIBLE)&&!t.tags.has(d.SCENERY)&&!t.tags.has(d.SILENT)})}(n,h);if(e){var r=i.filter(function(t){return t.meta.isInitialState&&t.initial});r.length>0&&(r.forEach(function(t){O.print(t.initial)}),o=r,i=i.filter(function(t){return!o.includes(t)}))}if(0!==i.length){var u=""+E.LOCATION_ITEMS_PREFIX+f(i,O)+".";O.print(u)}}},MESSAGES:E,noTurn:function(){p=!1},pause:function(t){void 0===t&&(t=0),L.hideInput(),N.add({pauseTime:t})},print:function(t,n){t&&(t instanceof Array?t.forEach(function(t){return O.print(t,n)}):N.add({outputText:O.dyntext(t),cssClass:n}))},get state(){return S},TAGS:d};L.onSubmit(function(e){e&&S.isActive&&(o=null,p=!0,O.print(e,"input"),L.clearInput(),function(t){var e=t.API,o=t.baseCommandMap,r=t.entities,u=t.commands,a=t.gameState,s=t.getSubject,c=t.config,p=t.gameMessages,l=t.afterCommand,m=n.default(t.inputText.toLowerCase()),v=m.verbs().out("array")[0],g=m.nouns().out("array")[0];if(!(v in o))return e.print(p.FAIL_UNKNOWN),void e.noTurn();var I=o[v],h=s(g,[e.location.things,e.inventory],function(t){return!t.tags.has(d.INVISIBLE)});if("function"==typeof c.onCommand){var T=!1,y=i(Object.keys(u),function(t,n){return I===n});if(y._base=I,c.onCommand({command:y,subject:h||{is:function(){return!1},exists:!1},game:e,stopCommand:function(t){void 0===t&&(t=!1),T=!0,t&&e.noTurn()},afterCommand:l,noTurn:e.noTurn}),T)return}if(a.isActive)if(e.location.to&&I in e.location.to)e.goTo(e.location.to[I]);else switch(I){case u.n:case u.s:case u.e:case u.w:case u.up:case u.down:case u.in:case u.out:return void e.print(p.FAIL_NO_EXIT);case u.look:return e.look(!0),void e.noTurn();case u.examine:return h?(e.print(h.description),void(h.meta.isExamined=!0)):(e.print(p.FAIL_EXAMINE),void e.noTurn());case u.get:return function(t){return t&&!t.tags.has(d.SCENERY)&&!t.tags.has(d.FIXED)}(h)?e.inventory.has(h.id)?(e.print(p.FAIL_GET_OWNED),void e.noTurn()):(e.location.things.delete(h.id),e.inventory.add(h.id),h.meta.isInitialState=!1,void e.print(p.OK_GET)):(e.print(p.FAIL_GET),void e.noTurn());case u.drop:return h&&e.inventory.has(h.id)?h.tags.has(d.FIXED)?(e.print(p.FAIL_DROP),void e.noTurn()):(e.inventory.delete(h.id),e.location.things.add(h.id),h.meta.isInitialState=!1,void e.print(p.OK_DROP)):(e.print(p.FAIL_DROP_OWNED),void e.noTurn());case u.inventory:if(0===e.inventory.size)return e.print(p.INV_NONE),void e.noTurn();var E=function(t,n){return[].concat(n.inventory).map(function(n){return t[n]}).filter(function(t){return!t.tags.has(d.INVISIBLE)&&!t.tags.has(d.SILENT)})}(r,e),S=f(E,e);return e.print(""+p.INV_PREFIX+S+"."),void e.noTurn();case u.help:return e.print("Basic commands: "+Object.values(u).join(", ")+". Try other words too!","info"),void e.noTurn();default:e.print(p.FAIL_UNHANDLED),e.noTurn()}}({inputText:e,API:O,baseCommandMap:g,entities:h,commands:m,gameState:S,getSubject:y,config:t,gameMessages:E,afterCommand:function(t){o=t}}),S.isActive&&("function"==typeof o&&(o(),o=null),S.isActive&&p&&(O.doTurn(),"function"==typeof t.onTurn&&t.onTurn({game:O,turnCount:S.turnCount}))))}),L.clearOutput(),O.goTo(S.currentLocationId,!0)}};
//# sourceMappingURL=index.js.map

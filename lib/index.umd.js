!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("compromise")):"function"==typeof define&&define.amd?define(["compromise"],n):(t||self).nidc2021Textadv=n(t.compromise)}(this,function(t){function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=/*#__PURE__*/n(t);function o(){return o=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},o.apply(this,arguments)}var i,r=function(t,n){return t.reduce(function(t,e){return t[e]=n(t,e),t},{})},u={n:"n",e:"e",w:"w",s:"s",up:"up",down:"down",in:"in",out:"out",look:"look",examine:"examine",get:"get",drop:"drop",inventory:"inventory",help:"help"},a=((i={})[u.n]=["north","go north"],i[u.e]=["east","go east"],i[u.w]=["west","go west"],i[u.s]=["south","go south"],i[u.up]=["u","go up","ascend"],i[u.down]=["d","go down","descend"],i[u.in]=["enter","go in","get in"],i[u.out]=["leave","go out","get out","exit"],i[u.look]=["look around","where","where am i","whereami"],i[u.examine]=["look at","inspect","x","ex","search","check"],i[u.get]=["g","take","pick up","obtain","acquire","grab"],i[u.drop]=["put down","toss","remove","discard"],i[u.inventory]=["inv","carrying","equipment","items","gear"],i[u.help]=["instructions","howto","how to play","?","commands","verbs","words","controls"],i),s={LOCATION_ITEMS_PREFIX:"You can see ",INV_PREFIX:"You are carrying ",INV_NONE:"You are carrying nothing.",FAIL_UNKNOWN:"Sorry, I don't understand.",FAIL_UNHANDLED:"Sorry, I can't do that.",FAIL_NO_EXIT:"You can't go that way.",FAIL_EXAMINE:"Sorry, I can't see that.",FAIL_GET:"Sorry, I can't get that.",FAIL_GET_OWNED:"You already seem to have that.",FAIL_DROP:"Sorry, I can't drop that.",FAIL_DROP_OWNED:"You don't seem to have that.",OK_GET:"Taken.",OK_DROP:"Dropped."},c={inputForm:".game-input",inputField:".game-typed-input",output:".game-output"},d="hidden",f=function(t){var n=t.UI,e=t.gameState,o=[],i=!1,r=function t(){if(!i){if(0===o.length)return i=!1,void(e.isActive&&n.showInput());i=!0;var r=o.shift();"pauseTime"in r?setTimeout(function(){i=!1,t()},r.pauseTime):(n.writeOutput(r.outputText,r.cssClass),n.scrollToBottom(),i=!1,t())}};return{add:function(t){o.push(t),r()}}},p=Object.freeze({FIXED:"fixed",INVISIBLE:"invisible",ITEM:"item",PRESENT:"present",SILENT:"silent"}),l=function(t,n){return t.map(function(t){return n.dyntext(t.summary)}).join(", ")},m=function(t){return t&&t.tags.has(p.ITEM)&&!t.tags.has(p.FIXED)&&!t.tags.has(p.INVISIBLE)};return{start:function(t){var n,i,v=function(t){var n=o({},u),i=o({},a);t.commands&&Object.entries(t.commands).forEach(function(t){var e=t[0],o=t[1];n[e]=e,i[e]=o});var s=r(Object.keys(i),function(t,n){return i[n].forEach(function(e){t[e]=n}),n});return e.default.extend(function(t,n){var e=r(Object.keys(s),function(){return"Verb"});n.addWords(e)}),{commands:n,aliases:i,baseCommandMap:s,nlp:e.default}}(t),g=v.commands,I=v.aliases,h=v.baseCommandMap,y=function(t){var n,o={},i=t.entities.reduce(function(e,r,u){var a=r(function(){return i[a.id]});if(!a.id)throw console.error(a),new Error("Missing entity id");return a.is=function(t){return a.id===t},a.exists=!0,a.meta={visitCount:0,isInitialState:!0,isExamined:!1},a.data||(a.data={}),a.things||(a.things=[]),a.tags||(a.tags=[]),a.things=new Set(a.things),a.tags=new Set(a.tags),a.nouns&&a.nouns.forEach(function(t){if(t in o)throw new Error("Duplicate noun '"+t+"' found for entity '"+a.id+"'");o[t]=a.id}),e[a.id]=a,0===u&&(n=t.startLocationId||a.id),e},{});return e.default.extend(function(t,n){var e=r(Object.keys(o),function(){return"Noun"});n.addWords(e)}),{entities:i,baseNounMap:o,startLocationId:n,getSubject:function(t,n,e){if(void 0===e&&(e=function(){return!0}),!(t in o))return!1;n instanceof Array||(n=[n]);var r=i[o[t]],u=!1;return n.forEach(function(t){t.has(r.id)&&e(r)&&(u=r)}),u}}}(t),T=y.entities,E=y.startLocationId,L=y.getSubject,S=o({},s),N={turnCount:0,isActive:!0,currentLocationId:E,inventory:new Set(t.startInventory||[]),lastSubject:null},O=function(t){void 0===t&&(t={});var n=o({},c,t),e=r(Object.keys(n),function(t,e){var o=n[e],i=document.querySelector(o);if(!i)throw new Error("No DOM element found for selector: "+o);return i}),i=function(){return e.inputField.value.trim()};return{els:e,onSubmit:function(t){e.inputForm.addEventListener("submit",function(n){n.preventDefault(),t(i())})},getInput:i,clearInput:function(){e.inputField.value=""},hideInput:function(){e.inputForm.classList.add(d)},showInput:function(){e.inputForm.classList.remove(d)},clearOutput:function(){e.output.innerHTML=""},writeOutput:function(t,n){var o=document.createElement("p");o.innerHTML=t,n&&o.classList.add(n),e.output.appendChild(o)},scrollToBottom:function(){window.scrollTo(0,document.body.scrollHeight)}}}(),A=f({UI:O,gameState:N}),w={ALIASES:I,COMMANDS:g,clear:function(){O.clearOutput()},doTurn:function(){N.turnCount+=1},dyntext:function(t){return"function"==typeof t?t(w):t},end:function(){N.isActive=!1,O.hideInput()},entity:function(t){if(!T[t])throw new Error("Game logic error: no entity '"+t+"' found");return T[t]},goTo:function(n,e){void 0===e&&(e=!1);var o=w.entity(n),i=!0;"function"==typeof t.onGoTo&&(i=t.onGoTo({game:w,destination:o})),!1!==i&&N.isActive&&("function"==typeof o.onGoTo&&(i=o.onGoTo({game:w})),!1!==i&&N.isActive&&(N.currentLocationId=n,w.location.meta.visitCount+=1,w.look(),e||w.doTurn(),"function"==typeof i&&i()))},get inventory(){return N.inventory},get location(){return T[N.currentLocationId]},look:function(n){void 0===n&&(n=!1);for(var e=w.location,o=n||1===e.meta.visitCount,i=!0,r=[t.onLook,e.onLook],u=0;u<2;u++){var a=r[u];if("function"==typeof a&&(!1===(i=a({game:w,isFullLook:o}))||!N.isActive))return}if(w.print(o?e.description:e.summary),0!==e.things.size){var s,c=function(t,n){return[].concat(t.things).map(function(t){return n[t]}).filter(function(t){return(t.tags.has(p.ITEM)||t.tags.has(p.PRESENT))&&!t.tags.has(p.INVISIBLE)&&!t.tags.has(p.SILENT)})}(e,T);if(o){var d=c.filter(function(t){return t.meta.isInitialState&&t.initial});d.length>0&&(d.forEach(function(t){w.print(t.initial)}),s=d,c=c.filter(function(t){return!s.includes(t)}))}if(0!==c.length){var f=""+S.LOCATION_ITEMS_PREFIX+l(c,w)+".";w.print(f),"function"==typeof i&&i()}else"function"==typeof i&&i()}else"function"==typeof i&&i()},MESSAGES:S,noTurn:function(){i=!1},pause:function(t){void 0===t&&(t=0),O.hideInput(),A.add({pauseTime:t})},print:function(t,n){t&&(t instanceof Array?t.forEach(function(t){return w.print(t,n)}):A.add({outputText:w.dyntext(t),cssClass:n}))},get state(){return N},TAGS:p};O.onSubmit(function(o){o&&N.isActive&&(n=null,i=!0,w.print(o,"input"),O.clearInput(),function(t){var n=t.API,o=t.baseCommandMap,i=t.entities,u=t.commands,a=t.gameState,s=t.getSubject,c=t.config,d=t.gameMessages,f=t.afterCommand,v=e.default(t.inputText.toLowerCase()),g=v.verbs().out("array")[0],I=v.nouns().out("array")[0];if(!(g in o))return n.print(d.FAIL_UNKNOWN),void n.noTurn();var h=o[g],y=s(I,[n.location.things,n.inventory],function(t){return!t.tags.has(p.INVISIBLE)});if("function"==typeof c.onCommand){var T,E=r(Object.keys(u),function(t,n){return h===n});if(E._base=h,!1===(T=c.onCommand({command:E,subject:y||{is:function(){return!1},exists:!1},game:n,noTurn:n.noTurn}))||!a.isActive)return;"function"==typeof T&&f(T)}if(n.location.to&&h in n.location.to)n.goTo(n.location.to[h]);else switch(h){case u.n:case u.s:case u.e:case u.w:case u.up:case u.down:case u.in:case u.out:return void n.print(d.FAIL_NO_EXIT);case u.look:return n.look(!0),void n.noTurn();case u.examine:return y?(n.print(y.description),void(y.meta.isExamined=!0)):(n.print(d.FAIL_EXAMINE),void n.noTurn());case u.get:return m(y)?n.inventory.has(y.id)?(n.print(d.FAIL_GET_OWNED),void n.noTurn()):(n.location.things.delete(y.id),n.inventory.add(y.id),y.meta.isInitialState=!1,void n.print(d.OK_GET)):(n.print(d.FAIL_GET),void n.noTurn());case u.drop:return y&&n.inventory.has(y.id)?m(y)?(n.inventory.delete(y.id),n.location.things.add(y.id),y.meta.isInitialState=!1,void n.print(d.OK_DROP)):(n.print(d.FAIL_DROP),void n.noTurn()):(n.print(d.FAIL_DROP_OWNED),void n.noTurn());case u.inventory:if(0===n.inventory.size)return n.print(d.INV_NONE),void n.noTurn();var L=function(t,n){return[].concat(n.inventory).map(function(n){return t[n]}).filter(function(t){return!t.tags.has(p.INVISIBLE)&&!t.tags.has(p.SILENT)})}(i,n),S=l(L,n);return n.print(""+d.INV_PREFIX+S+"."),void n.noTurn();case u.help:return n.print("Basic commands: "+Object.values(u).join(", ")+". Try other words too!","info"),void n.noTurn();default:n.print(d.FAIL_UNHANDLED),n.noTurn()}}({inputText:o,API:w,baseCommandMap:h,entities:T,commands:g,gameState:N,getSubject:L,config:t,gameMessages:S,afterCommand:function(t){n=t}}),N.isActive&&("function"==typeof n&&(n(),n=null),N.isActive&&i&&(w.doTurn(),"function"==typeof t.onTurn&&t.onTurn({game:w,turnCount:N.turnCount}))))}),O.clearOutput(),w.goTo(N.currentLocationId,!0)}}});
//# sourceMappingURL=index.umd.js.map

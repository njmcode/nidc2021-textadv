!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("compromise")):"function"==typeof define&&define.amd?define(["compromise"],t):(n||self).nidc2021Textadv=t(n.compromise)}(this,function(n){function t(n){return n&&"object"==typeof n&&"default"in n?n:{default:n}}var o=/*#__PURE__*/t(n);function e(){return e=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(n[e]=o[e])}return n},e.apply(this,arguments)}var i,r={inputForm:".game-input",inputField:".game-typed-input",output:".game-output"},a="hidden",u={n:"n",e:"e",w:"w",s:"s",up:"up",down:"down",in:"in",out:"out",look:"look",examine:"examine",get:"get",drop:"drop",inventory:"inventory",help:"help"},c=((i={})[u.n]=["north","go north"],i[u.e]=["east","go east"],i[u.w]=["west","go west"],i[u.s]=["south","go south"],i[u.up]=["u","go up","ascend"],i[u.down]=["d","go down","descend"],i[u.in]=["enter","go in","get in"],i[u.out]=["leave","go out","get out","exit"],i[u.look]=["look around","where","where am i","whereami"],i[u.examine]=["look at","inspect","x","ex","search","check"],i[u.get]=["g","take","pick up","obtain","acquire","grab"],i[u.drop]=["put down","toss","remove","discard"],i[u.inventory]=["inv","carrying","equipment","items","gear"],i[u.help]=["instructions","howto","how to play","?","commands","verbs","words","controls"],i),s={LOCATION_ITEMS_PREFIX:"You can see ",INV_PREFIX:"You are carrying ",INV_NONE:"You are carrying nothing.",FAIL_UNKNOWN:"Sorry, I don't understand.",FAIL_UNHANDLED:"Sorry, I can't do that.",FAIL_NO_EXIT:"You can't go that way.",FAIL_EXAMINE:"Sorry, I can't see that.",FAIL_GET:"Sorry, I can't get that.",FAIL_GET_OWNED:"You already seem to have that.",FAIL_DROP:"Sorry, I can't drop that.",FAIL_DROP_OWNED:"You don't seem to have that.",OK_GET:"Taken.",OK_DROP:"Dropped."},d=Object.freeze({SILENT:"silent",INVISIBLE:"invisible",FIXED:"fixed",QUIET:"quiet",SCENERY:"scenery"});return{start:function(n){var t,i,f=function(n){void 0===n&&(n={});var t=e({},r,n),o=Object.entries(t).reduce(function(n,t){var o=t[0],e=t[1],i=document.querySelector(e);if(!i)throw new Error("No DOM element found for selector: "+e);return n[o]=i,n},{}),i=function(){return o.inputField.value.trim()};return{els:o,onSubmit:function(n){o.inputForm.addEventListener("submit",function(t){t.preventDefault(),n(i())})},getInput:i,clearInput:function(){o.inputField.value=""},hideInput:function(){o.inputForm.classList.add(a)},showInput:function(){o.inputForm.classList.remove(a)},clearOutput:function(){o.output.innerHTML=""},writeOutput:function(n,t){var e=document.createElement("p");e.innerHTML=n,t&&e.classList.add(t),o.output.appendChild(e)},scrollToBottom:function(){window.scrollTo(0,document.body.scrollHeight)}}}(),p=function(n){var t=e({},u),i=e({},c);n.commands&&Object.entries(n.commands).forEach(function(n){var o=n[0],e=n[1];t[o]=o,i[o]=e});var r=Object.entries(i).reduce(function(n,t){var o=t[0],e=t[1];return n[o]=o,e.forEach(function(t){n[t]=o}),n},{});return o.default.extend(function(n,t){var o=Object.keys(r).reduce(function(n,t){return n[t]="Verb",n},{});t.addWords(o)}),{commands:t,aliases:i,baseCommandMap:r,nlp:o.default}}(n),l=p.commands,m=p.aliases,v=p.baseCommandMap,g=function(n){var t,e={},i=n.entities.reduce(function(o,r,a){var u=r(function(){return i[u.id]});if(!u.id)throw console.error(u),new Error("Missing entity id");return u.is=function(n){return u.id===n},u.exists=!0,u.meta={visitCount:0,isInitialState:!0,isExamined:!1},u.nouns&&u.nouns.forEach(function(n){if(n in e)throw new Error("Duplicate noun '"+n+"' found for entity '"+u.id+"'");e[n]=u.id}),u.data||(u.data={}),u.things||(u.things=[]),u.tags||(u.tags=[]),u.things=new Set(u.things),u.tags=new Set(u.tags),o[u.id]=u,0===a&&(t=n.startLocationId||u.id),o},{});return o.default.extend(function(n,t){var o=Object.keys(e).reduce(function(n,t){return n[t]="Noun",n},{});t.addWords(o)}),{entities:i,baseNounMap:e,startLocationId:t,getSubject:function(n,t,o){if(void 0===o&&(o=function(){return!0}),!(n in e))return!1;t instanceof Array||(t=[t]);var r=i[e[n]],a=!1;return t.forEach(function(n){n.has(r.id)&&o(r)&&(a=r)}),a}}}(n),I=g.entities,h=g.startLocationId,y=g.getSubject,E=e({},s),T={turnCount:0,isActive:!0,currentLocationId:h,inventory:new Set(n.startInventory||[]),lastSubject:null},L={ALIASES:m,COMMANDS:l,clear:function(){f.clearOutput()},doTurn:function(){T.turnCount+=1},dyntext:function(n){return"function"==typeof n?n(L):n},end:function(){T.isActive=!1,f.hideInput()},entity:function(n){if(!I[n])throw new Error("Game logic error: no entity '"+n+"' found");return I[n]},goTo:function(t,o){void 0===o&&(o=!1);var e=L.entity(t),i=!1,r=null,a=function(){i=!0},u=function(n){r=n};"function"==typeof n.onGoTo&&n.onGoTo({game:L,destination:e,stopGoTo:a,afterGoTo:u}),T.isActive&&!i&&("function"==typeof e.onGoTo&&e.onGoTo({game:L,stopGoTo:a,afterGoTo:u}),T.isActive&&!i&&(T.currentLocationId=t,L.location.meta.visitCount+=1,L.look(),o||L.doTurn(),"function"==typeof r&&r()))},get inventory(){return T.inventory},get location(){return I[T.currentLocationId]},look:function(n){void 0===n&&(n=!1);var t=n||1===L.location.meta.visitCount;if(L.print(t?L.location.description:L.location.summary),L.location.things.size>0){var o=[].concat(L.location.things).map(function(n){return I[n]}).filter(function(n){return!n.tags.has(d.INVISIBLE)&&!n.tags.has(d.SCENERY)&&!n.tags.has(d.SILENT)});if(t){var e=o.filter(function(n){return n.meta.isInitialState&&n.initial});e.length>0&&e.forEach(function(n){L.print(n.initial)}),o=o.filter(function(n){return!e.includes(n)})}if(o.length>0){var i=""+E.LOCATION_ITEMS_PREFIX+o.map(function(n){return L.dyntext(n.summary)}).join(", ")+".";L.print(i)}}},MESSAGES:E,noTurn:function(){i=!1},print:function(n,t){n&&(n instanceof Array?n.forEach(function(n){return L.print(n,t)}):(f.writeOutput(L.dyntext(n),t),f.scrollToBottom()))},get state(){return T},TAGS:d};f.onSubmit(function(e){e&&T.isActive&&(t=null,i=!0,L.print(e,"input"),f.clearInput(),function(n){var t=n.API,e=n.baseCommandMap,i=n.entities,r=n.commands,a=n.gameState,u=n.getSubject,c=n.config,s=n.gameMessages,f=n.afterCommand,p=o.default(n.inputText.toLowerCase()),l=p.verbs().out("array")[0],m=p.nouns().out("array")[0];if(!(l in e))return t.print(s.FAIL_UNKNOWN),void t.noTurn();var v=e[l],g=u(m,[t.location.things,t.inventory],function(n){return!n.tags.has(d.INVISIBLE)});if("function"==typeof c.onCommand){var I=!1,h=Object.keys(r).reduce(function(n,t){return n[t]=v===t,n},{});if(h._base=v,c.onCommand({command:h,subject:g||{is:function(){return!1},exists:!1},game:t,stopCommand:function(n){void 0===n&&(n=!1),I=!0,n&&t.noTurn()},afterCommand:f,noTurn:t.noTurn}),I)return}if(a.isActive)if(t.location.to&&v in t.location.to)t.goTo(t.location.to[v]);else switch(v){case r.n:case r.s:case r.e:case r.w:case r.up:case r.down:case r.in:case r.out:return void t.print(s.FAIL_NO_EXIT);case r.look:return t.look(!0),void t.noTurn();case r.examine:return g?(t.print(g.description),void(g.meta.isExamined=!0)):(t.print(s.FAIL_EXAMINE),void t.noTurn());case r.get:return!g||g.tags.has(d.SCENERY)||g.tags.has(d.FIXED)?(t.print(s.FAIL_GET),void t.noTurn()):t.inventory.has(g.id)?(t.print(s.FAIL_GET_OWNED),void t.noTurn()):(t.location.things.delete(g.id),t.inventory.add(g.id),g.meta.isInitialState=!1,void t.print(s.OK_GET));case r.drop:return g&&t.inventory.has(g.id)?g.tags.has(d.FIXED)?(t.print(s.FAIL_DROP),void t.noTurn()):(t.inventory.delete(g.id),t.location.things.add(g.id),g.meta.isInitialState=!1,void t.print(s.OK_DROP)):(t.print(s.FAIL_DROP_OWNED),void t.noTurn());case r.inventory:if(0===t.inventory.size)return t.print(s.INV_NONE),void t.noTurn();var y=[].concat(t.inventory).map(function(n){return i[n]}).filter(function(n){return!n.tags.has(d.INVISIBLE)&&!n.tags.has(d.SILENT)}).map(function(n){return t.dyntext(n.summary)}).join(", ");return t.print(""+s.INV_PREFIX+y+"."),void t.noTurn();case r.help:return t.print("Basic commands: "+Object.values(r).join(", ")+". Try other words too!","info"),void t.noTurn();default:t.print(s.FAIL_UNHANDLED),t.noTurn()}}({inputText:e,API:L,baseCommandMap:v,entities:I,commands:l,gameState:T,getSubject:y,config:n,gameMessages:E,afterCommand:function(n){t=n}}),T.isActive&&("function"==typeof t&&(t(),t=null),T.isActive&&i&&(L.doTurn(),"function"==typeof n.onTurn&&n.onTurn({game:L,turnCount:T.turnCount}))))}),f.clearOutput(),L.goTo(T.currentLocationId,!0)}}});
//# sourceMappingURL=index.umd.js.map

!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("compromise")):"function"==typeof define&&define.amd?define(["compromise"],t):(n||self).nidc2021Textadv=t(n.compromise)}(this,function(n){function t(n){return n&&"object"==typeof n&&"default"in n?n:{default:n}}var e=/*#__PURE__*/t(n);function o(){return o=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},o.apply(this,arguments)}var i,r=function(n,t){return n.reduce(function(n,e){return n[e]=t(n,e),n},{})},u={n:"n",e:"e",w:"w",s:"s",up:"up",down:"down",in:"in",out:"out",look:"look",examine:"examine",get:"get",drop:"drop",inventory:"inventory",help:"help"},a=((i={})[u.n]=["north","go north"],i[u.e]=["east","go east"],i[u.w]=["west","go west"],i[u.s]=["south","go south"],i[u.up]=["u","go up","ascend"],i[u.down]=["d","go down","descend"],i[u.in]=["enter","go in","get in"],i[u.out]=["leave","go out","get out","exit"],i[u.look]=["look around","where","where am i","whereami"],i[u.examine]=["look at","inspect","x","ex","search","check"],i[u.get]=["g","take","pick up","obtain","acquire","grab"],i[u.drop]=["put down","toss","remove","discard"],i[u.inventory]=["inv","carrying","equipment","items","gear"],i[u.help]=["instructions","howto","how to play","?","commands","verbs","words","controls"],i),s={LOCATION_ITEMS_PREFIX:"You can see ",INV_PREFIX:"You are carrying ",INV_NONE:"You are carrying nothing.",FAIL_UNKNOWN:"Sorry, I don't understand.",FAIL_UNHANDLED:"Sorry, I can't do that.",FAIL_NO_EXIT:"You can't go that way.",FAIL_EXAMINE:"Sorry, I can't see that.",FAIL_GET:"Sorry, I can't get that.",FAIL_GET_OWNED:"You already seem to have that.",FAIL_DROP:"Sorry, I can't drop that.",FAIL_DROP_OWNED:"You don't seem to have that.",OK_GET:"Taken.",OK_DROP:"Dropped."},c={inputForm:".game-input",inputField:".game-typed-input",output:".game-output"},d="hidden",f=function(n){var t=n.UI,e=n.gameState,o=[],i=!1,r=function n(){if(!i){if(0===o.length)return i=!1,void(e.isActive&&t.showInput());i=!0;var r=o.shift();"pauseTime"in r?setTimeout(function(){i=!1,n()},r.pauseTime):(t.writeOutput(r.outputText,r.cssClass),t.scrollToBottom(),i=!1,n())}};return{add:function(n){o.push(n),r()}}},p=Object.freeze({SILENT:"silent",INVISIBLE:"invisible",FIXED:"fixed",QUIET:"quiet",SCENERY:"scenery"}),l=function(n,t){return n.map(function(n){return t.dyntext(n.summary)}).join(", ")};return{start:function(n){var t,i,m=function(n){var t=o({},u),i=o({},a);n.commands&&Object.entries(n.commands).forEach(function(n){var e=n[0],o=n[1];t[e]=e,i[e]=o});var s=r(Object.keys(i),function(n,t){return i[t].forEach(function(e){n[e]=t}),t});return e.default.extend(function(n,t){var e=r(Object.keys(s),function(){return"Verb"});t.addWords(e)}),{commands:t,aliases:i,baseCommandMap:s,nlp:e.default}}(n),v=m.commands,g=m.aliases,I=m.baseCommandMap,h=function(n){var t,o={},i=n.entities.reduce(function(e,r,u){var a=r(function(){return i[a.id]});if(!a.id)throw console.error(a),new Error("Missing entity id");return a.is=function(n){return a.id===n},a.exists=!0,a.meta={visitCount:0,isInitialState:!0,isExamined:!1},a.data||(a.data={}),a.things||(a.things=[]),a.tags||(a.tags=[]),a.things=new Set(a.things),a.tags=new Set(a.tags),a.nouns&&a.nouns.forEach(function(n){if(n in o)throw new Error("Duplicate noun '"+n+"' found for entity '"+a.id+"'");o[n]=a.id}),e[a.id]=a,0===u&&(t=n.startLocationId||a.id),e},{});return e.default.extend(function(n,t){var e=r(Object.keys(o),function(){return"Noun"});t.addWords(e)}),{entities:i,baseNounMap:o,startLocationId:t,getSubject:function(n,t,e){if(void 0===e&&(e=function(){return!0}),!(n in o))return!1;t instanceof Array||(t=[t]);var r=i[o[n]],u=!1;return t.forEach(function(n){n.has(r.id)&&e(r)&&(u=r)}),u}}}(n),T=h.entities,y=h.startLocationId,E=h.getSubject,S=o({},s),L={turnCount:0,isActive:!0,currentLocationId:y,inventory:new Set(n.startInventory||[]),lastSubject:null},N=function(n){void 0===n&&(n={});var t=o({},c,n),e=r(Object.keys(t),function(n,e){var o=t[e],i=document.querySelector(o);if(!i)throw new Error("No DOM element found for selector: "+o);return i}),i=function(){return e.inputField.value.trim()};return{els:e,onSubmit:function(n){e.inputForm.addEventListener("submit",function(t){t.preventDefault(),n(i())})},getInput:i,clearInput:function(){e.inputField.value=""},hideInput:function(){e.inputForm.classList.add(d)},showInput:function(){e.inputForm.classList.remove(d)},clearOutput:function(){e.output.innerHTML=""},writeOutput:function(n,t){var o=document.createElement("p");o.innerHTML=n,t&&o.classList.add(t),e.output.appendChild(o)},scrollToBottom:function(){window.scrollTo(0,document.body.scrollHeight)}}}(),O=f({UI:N,gameState:L}),w={ALIASES:g,COMMANDS:v,clear:function(){N.clearOutput()},doTurn:function(){L.turnCount+=1},dyntext:function(n){return"function"==typeof n?n(w):n},end:function(){L.isActive=!1,N.hideInput()},entity:function(n){if(!T[n])throw new Error("Game logic error: no entity '"+n+"' found");return T[n]},goTo:function(t,e){void 0===e&&(e=!1);var o=w.entity(t),i=!1,r=null,u=function(){i=!0},a=function(n){r=n};"function"==typeof n.onGoTo&&n.onGoTo({game:w,destination:o,stopGoTo:u,afterGoTo:a}),L.isActive&&!i&&("function"==typeof o.onGoTo&&o.onGoTo({game:w,stopGoTo:u,afterGoTo:a}),L.isActive&&!i&&(L.currentLocationId=t,w.location.meta.visitCount+=1,w.look(),e||w.doTurn(),"function"==typeof r&&r()))},get inventory(){return L.inventory},get location(){return T[L.currentLocationId]},look:function(n){void 0===n&&(n=!1);var t=w.location,e=n||1===t.meta.visitCount;if(w.print(e?t.description:t.summary),0!==t.things.size){var o,i=function(n,t){return[].concat(n.things).map(function(n){return t[n]}).filter(function(n){return!n.tags.has(p.INVISIBLE)&&!n.tags.has(p.SCENERY)&&!n.tags.has(p.SILENT)})}(t,T);if(e){var r=i.filter(function(n){return n.meta.isInitialState&&n.initial});r.length>0&&(r.forEach(function(n){w.print(n.initial)}),o=r,i=i.filter(function(n){return!o.includes(n)}))}if(0!==i.length){var u=""+S.LOCATION_ITEMS_PREFIX+l(i,w)+".";w.print(u)}}},MESSAGES:S,noTurn:function(){i=!1},pause:function(n){void 0===n&&(n=0),N.hideInput(),O.add({pauseTime:n})},print:function(n,t){n&&(n instanceof Array?n.forEach(function(n){return w.print(n,t)}):O.add({outputText:w.dyntext(n),cssClass:t}))},get state(){return L},TAGS:p};N.onSubmit(function(o){o&&L.isActive&&(t=null,i=!0,w.print(o,"input"),N.clearInput(),function(n){var t=n.API,o=n.baseCommandMap,i=n.entities,u=n.commands,a=n.gameState,s=n.getSubject,c=n.config,d=n.gameMessages,f=n.afterCommand,m=e.default(n.inputText.toLowerCase()),v=m.verbs().out("array")[0],g=m.nouns().out("array")[0];if(!(v in o))return t.print(d.FAIL_UNKNOWN),void t.noTurn();var I=o[v],h=s(g,[t.location.things,t.inventory],function(n){return!n.tags.has(p.INVISIBLE)});if("function"==typeof c.onCommand){var T=!1,y=r(Object.keys(u),function(n,t){return I===t});if(y._base=I,c.onCommand({command:y,subject:h||{is:function(){return!1},exists:!1},game:t,stopCommand:function(n){void 0===n&&(n=!1),T=!0,n&&t.noTurn()},afterCommand:f,noTurn:t.noTurn}),T)return}if(a.isActive)if(t.location.to&&I in t.location.to)t.goTo(t.location.to[I]);else switch(I){case u.n:case u.s:case u.e:case u.w:case u.up:case u.down:case u.in:case u.out:return void t.print(d.FAIL_NO_EXIT);case u.look:return t.look(!0),void t.noTurn();case u.examine:return h?(t.print(h.description),void(h.meta.isExamined=!0)):(t.print(d.FAIL_EXAMINE),void t.noTurn());case u.get:return function(n){return n&&!n.tags.has(p.SCENERY)&&!n.tags.has(p.FIXED)}(h)?t.inventory.has(h.id)?(t.print(d.FAIL_GET_OWNED),void t.noTurn()):(t.location.things.delete(h.id),t.inventory.add(h.id),h.meta.isInitialState=!1,void t.print(d.OK_GET)):(t.print(d.FAIL_GET),void t.noTurn());case u.drop:return h&&t.inventory.has(h.id)?h.tags.has(p.FIXED)?(t.print(d.FAIL_DROP),void t.noTurn()):(t.inventory.delete(h.id),t.location.things.add(h.id),h.meta.isInitialState=!1,void t.print(d.OK_DROP)):(t.print(d.FAIL_DROP_OWNED),void t.noTurn());case u.inventory:if(0===t.inventory.size)return t.print(d.INV_NONE),void t.noTurn();var E=function(n,t){return[].concat(t.inventory).map(function(t){return n[t]}).filter(function(n){return!n.tags.has(p.INVISIBLE)&&!n.tags.has(p.SILENT)})}(i,t),S=l(E,t);return t.print(""+d.INV_PREFIX+S+"."),void t.noTurn();case u.help:return t.print("Basic commands: "+Object.values(u).join(", ")+". Try other words too!","info"),void t.noTurn();default:t.print(d.FAIL_UNHANDLED),t.noTurn()}}({inputText:o,API:w,baseCommandMap:I,entities:T,commands:v,gameState:L,getSubject:E,config:n,gameMessages:S,afterCommand:function(n){t=n}}),L.isActive&&("function"==typeof t&&(t(),t=null),L.isActive&&i&&(w.doTurn(),"function"==typeof n.onTurn&&n.onTurn({game:w,turnCount:L.turnCount}))))}),N.clearOutput(),w.goTo(L.currentLocationId,!0)}}});
//# sourceMappingURL=index.umd.js.map
